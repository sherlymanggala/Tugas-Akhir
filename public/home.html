<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <link rel="stylesheet" type="text/css" href="style.css" media="screen" />
        
        <!-- Bootstrap CSS -->
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
        <title>Multi&#45;Inventory Prototype Web App</title>
        
        <!-- Bootstrap -->
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>

        <!-- update the version number as needed -->
        <script src="https://www.gstatic.com/firebasejs/4.3.0/firebase.js"></script>
        <script>
            // Initialize Firebase
            const config = {
                apiKey: "AIzaSyA_NK_kBO7DABY-7InCTNK9pNNITHnrlCE",
                authDomain: "multi-inventory.firebaseapp.com",
                databaseURL: "https://multi-inventory.firebaseio.com",
                projectId: "multi-inventory",
                storageBucket: "multi-inventory.appspot.com",
            };
            firebase.initializeApp(config);
            var database = firebase.database();
        </script>
        
        <!-- Function code here -->
        <script type="text/javascript">
            function handleLogout() {
                firebase.auth().signOut().then(function() {
                    window.location = 'index.html';
                }).catch(function(error) {
                    console.log(error);
                });
            }
            
            /* Read data from database */
            function readUser(userId) {
                var userRef = firebase.database().ref('users/' + userId);
                var nameRef = userRef.child('name');
                nameRef.once("value").then(function(snapshot) {
                    console.log(snapshot.val());
                    document.getElementById('username').innerHTML = snapshot.val();
                });
            }
            
            function initApp() {
                firebase.auth().onAuthStateChanged(function(user) {
                    if (user) {
                        readUser(user.uid);
                        var userRef = database.ref('users/' + user.uid).child('role');
                        userRef.once('value', function(snapshot) {
                            console.log(snapshot.val());
                            
                            if(snapshot.val() == 'user') {                                
                                //document.getElementsByClassName('userRole').remove();
                                var elements = document.getElementsByClassName('userRole');
                                while(elements.length > 0) {
                                    elements[0].parentNode.removeChild(elements[0]);
                                }
                            }
                        });
                        return;
                    }
                    /*else {
                        window.location = 'index.html';
                        alert('Error, you must log in first.');
                    }*/
                });
                
                document.getElementById('btnLogout').addEventListener('click', handleLogout, false);
            }
            
            window.onload = function() {
                initApp();
            };            
        </script>
    </head>
    <body>
        <!-- Navbar Menu -->
        <nav class="navbar navbar-default">
            <div class="container-fluid">
                <div class="navbar-header">
                    <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#toggleNavbar">
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </button>
                </div>
                <div class="collapse navbar-collapse" id="toggleNavbar">
                    <ul class="nav navbar-nav">
                        <li class="active"><a href="home.html">Home</a></li>
                        <li><a href="input.html">Input New Data</a></li>
                        <li><a href="update.html">Update Stock</a></li>
                        <li class="userRole"><a href="view.html">View Data</a></li>
                        <li class="userRole"><a href="delete.html">Delete Data</a></li>
                        
                         <!--For dropdown menu--> 
                        <li class="dropdown userRole">
                            <a class="dropdown-toggle" data-toggle="dropdown" href="#">Manage Accounts <span class="caret"></span></a>
                            <ul class="dropdown-menu">
                                <li><a href="manage.html">View Accounts</a></li>
                                <li><a href="change_role.html">Manage User's Role</a></li>
                            </ul>
                        </li>
                    </ul>
                    <ul class="nav navbar-nav navbar-right">
                        <li id="btnLogout"><a href="#">Log out</a></li>
                    </ul>
                </div>
            </div>
        </nav>
        <!-- End of navbar -->
        
        <div id="home" class="container">
            <h1>Welcome back, <span id="username"></span></h1>
            <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Ut viverra sem euismod, mattis ipsum id, cursus odio. Nulla ligula nibh, sollicitudin nec elit non, consequat lacinia turpis. Donec fringilla sollicitudin enim, quis fringilla neque molestie vitae. Suspendisse potenti. Duis vitae commodo lacus, nec imperdiet augue. Suspendisse vel eleifend velit. Quisque semper porttitor vestibulum. Phasellus fermentum, enim id convallis tempor, sapien enim venenatis diam, eget viverra arcu lectus eu erat. Cras sed aliquam orci. Suspendisse scelerisque purus eu placerat ullamcorper. Vestibulum tristique urna sollicitudin ante volutpat gravida. Mauris sollicitudin urna rhoncus iaculis bibendum. Sed ornare elit sed nunc cursus commodo.</p>
        </div>
    </body>
</html>